# ëª¨ë‘ì˜ ë©”ë‰´ í”„ë¡œì íŠ¸ - Cursor Rules

## ğŸŒ ì–¸ì–´ ì„¤ì •
- í•­ìƒ í•œêµ­ì–´ë¡œ ì‘ë‹µí•˜ì„¸ìš”
- ì½”ë“œ ì£¼ì„ë„ í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ì„¸ìš”

## ğŸ“‹ í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸
ì´ í”„ë¡œì íŠ¸ëŠ” "ëª¨ë‘ì˜ ë©”ë‰´" - ì‹¤ì‹œê°„ ìœ„ì¹˜ ê¸°ë°˜ ë©”ë‰´ ì£¼ë¬¸ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
- **ê¸°ìˆ  ìŠ¤íƒ**: React 19 + TypeScript + Vite, MUI v7, Firebase, Zustand
- **ë°°í¬ í™˜ê²½**: Flutter WebView
- **í˜„ì¬ ìƒíƒœ**: Phase 4 ì§„í–‰ ì¤‘ (Flutter â†” WebView ìœ„ì¹˜ ì •ë³´ ì—°ë™ + ì½”ë“œ ë¦¬íŒ©í† ë§ ì™„ë£Œ)
- **ë‹¤ìŒ ëª©í‘œ**: Phase 4 ê³„ì† (QRì½”ë“œ ìŠ¤ìº”, ì¥ë°”êµ¬ë‹ˆ ì‹œìŠ¤í…œ)

## ğŸ¯ ìµœìš°ì„  ì›ì¹™
1. **WebView ìµœì í™”ê°€ ìµœìš°ì„ ** - ì¼ë°˜ ì›¹ ìµœì í™”ë³´ë‹¤ WebView íŠ¹ì„±ì— ë§ì¶˜ ìµœì í™”
2. **ì¦‰ì‹œ ì‘ë‹µì„±** - ì‚¬ìš©ì ê²½í—˜ê³¼ ì¦‰ì‹œ ì‘ë‹µì„±ì´ ë©”ëª¨ì´ì œì´ì…˜ë³´ë‹¤ ìš°ì„ 
3. **MUI v7 í˜¸í™˜ì„±** - ë°˜ë“œì‹œ ìµœì‹  v7 ë¬¸ë²• ì‚¬ìš©
4. **íƒ€ì… ì•ˆì „ì„±** - TypeScript strict ëª¨ë“œ ì¤€ìˆ˜

## ğŸ“± WebView í™˜ê²½ ìµœì í™” ê·œì¹™

### âœ… ê¶Œì¥ ì‚¬í•­
- ìƒˆ ì»´í¬ë„ŒíŠ¸ì—ì„œ `React.memo` ì‚¬ìš© **ì§€ì–‘** (ì¦‰ì‹œ ë Œë”ë§ ìš°ì„ )
- í™”ë©´ ì „í™˜ ì‹œ `optimizeWebViewTransition()` **ê¶Œì¥ í˜¸ì¶œ**
- ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œ `requestAnimationFrame` í™œìš©
- WebView ì „ìš© ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì ê·¹ í™œìš©:
  - `optimizeWebViewTransition()` - í™”ë©´ ì „í™˜ ìµœì í™”
  - `isWebView()` - WebView í™˜ê²½ ê°ì§€
  - `optimizeWebViewLogout()` - ë¡œê·¸ì•„ì›ƒ ìµœì í™”

### ğŸ¯ ê³ ê°ìš© í™”ë©´ êµ¬í˜„ íŒ¨í„´
```typescript
// âœ… ë„¤ë¹„ê²Œì´ì…˜ ì—°ê²° ì‹œ WebView ìµœì í™” ì ìš©
const handleNavigation = () => {
  optimizeWebViewTransition();
  navigate('/target-path');
};

// âœ… ì¹´í…Œê³ ë¦¬ ìë™ ì„ íƒ íŒ¨í„´
const [selectedCategoryId, setSelectedCategoryId] = useState<string>('');

useEffect(() => {
  if (categories.length > 0 && !selectedCategoryId) {
    setSelectedCategoryId(categories[0].id);
  }
}, [categories, selectedCategoryId]);

// âœ… í•„í„°ë§ëœ ë°ì´í„° ê³„ì‚°
const filteredItems = useMemo(() => {
  if (!selectedCategoryId) return [];
  return items.filter(item => item.categoryId === selectedCategoryId);
}, [items, selectedCategoryId]);

// âœ… ìŠ¬ë¼ì´ë“œ ê¸°ëŠ¥ êµ¬í˜„ íŒ¨í„´ (react-swipeable)
import { useSwipeable } from 'react-swipeable';

const handleSwipe = (direction: 'left' | 'right') => {
  if (categories.length === 0) return;
  
  const currentIndex = categories.findIndex(cat => cat.id === selectedCategoryId);
  if (currentIndex === -1) return;
  
  let newIndex: number;
  
  if (direction === 'left') {
    // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ (ë‹¤ìŒ ì¹´í…Œê³ ë¦¬)
    newIndex = (currentIndex + 1) % categories.length;
  } else {
    // ì™¼ìª½ìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ (ì´ì „ ì¹´í…Œê³ ë¦¬)
    newIndex = currentIndex === 0 ? categories.length - 1 : currentIndex - 1;
  }
  
  setSelectedCategoryId(categories[newIndex].id);
};

const swipeHandlers = useSwipeable({
  onSwipedLeft: () => handleSwipe('left'),
  onSwipedRight: () => handleSwipe('right'),
  preventScrollOnSwipe: true,
  trackMouse: false,
  delta: 50, // ìµœì†Œ ìŠ¬ë¼ì´ë“œ ê±°ë¦¬
  swipeDuration: 500, // ìŠ¬ë¼ì´ë“œ ì§€ì† ì‹œê°„
});

// ì‚¬ìš©ë²•: <Box {...swipeHandlers} sx={{ touchAction: 'pan-y' }}>
```

### ğŸ“ WebView í—¬í¼ ì‚¬ìš©ë²•
```typescript
import { optimizeWebViewTransition } from '@/utils/webviewHelper';

// í™”ë©´ ì „í™˜ ì „ ê¶Œì¥ í˜¸ì¶œ
const handleNavigation = () => {
  optimizeWebViewTransition();
  navigate('/target-screen');
};

// Flutter ìœ„ì¹˜ ì •ë³´ ì—°ë™
import { checkFlutterLocationPermission, getFlutterLocation } from '@/utils/webviewHelper';

// Flutterì—ì„œ ì „ë‹¬ë°›ì€ ìœ„ì¹˜ ì •ë³´ ìš°ì„  ì‚¬ìš©
const getLocation = async () => {
  // 1. Flutterì—ì„œ ì „ë‹¬ë°›ì€ ìœ„ì¹˜ ì •ë³´ í™•ì¸
  const flutterPermission = await checkFlutterLocationPermission();
  if (flutterPermission) {
    const flutterLocation = await getFlutterLocation();
    if (flutterLocation) {
      return flutterLocation; // Flutter ìœ„ì¹˜ ì‚¬ìš©
    }
  }
  
  // 2. Flutter ìœ„ì¹˜ ì •ë³´ê°€ ì—†ìœ¼ë©´ ë¸Œë¼ìš°ì € GPS ì‚¬ìš©
  return await getCurrentLocation();
};
```

## ğŸ¨ MUI v7 ì‚¬ìš© ê·œì¹™

### âœ… ê¶Œì¥ ì‚¬í•­ (v7 í˜¸í™˜)
```typescript
// âœ… MUI v7 Grid (ì‚¬ìš© ê°€ëŠ¥)
<Grid container spacing={2}>
  <Grid xs={12} md={6}>  {/* item ì†ì„± ì œê±°ë¨ */}
    <Card>ë‚´ìš©</Card>
  </Grid>
</Grid>

// âœ… Box + CSS Grid (ë” ê¶Œì¥ë¨)
<Box sx={{ 
  display: 'grid', 
  gridTemplateColumns: { xs: '1fr', sm: 'repeat(2, 1fr)', md: 'repeat(3, 1fr)' },
  gap: 2 
}}>
  <Card>ë‚´ìš©</Card>
</Box>

// âœ… Tab ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¶ˆí•„ìš”í•œ ì•„ì´ì½˜ ì œê±°
<Tab
  label={`${category.icon} ${category.name} (${count})`}
  value={category.id}
  // icon ì†ì„± ì œê±° - ì´ëª¨ì§€ ì•„ì´ì½˜ì´ ì´ë¯¸ labelì— í¬í•¨ë¨
/>
```
<Box sx={{ 
  display: 'grid', 
  gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))', 
  gap: 2 
}}>
  <Card>ë‚´ìš©</Card>
</Box>

// âœ… ListItemButton ì‚¬ìš©
<ListItemButton onClick={handleClick}>
  <ListItemText primary="ë©”ë‰´ í•­ëª©" />
</ListItemButton>
```

### âŒ ì§€ì–‘ ì‚¬í•­ (v6 ì´í•˜)
```typescript
// âŒ êµ¬ë²„ì „ Grid ë¬¸ë²•
<Grid item xs={12}>  {/* item ì†ì„± ì‚¬ìš© ì§€ì–‘ */}

// âŒ êµ¬ë²„ì „ ListItem
<ListItem button onClick={handleClick}>  {/* button ì†ì„± ì‚¬ìš© ì§€ì–‘ */}
```

## ğŸ”¥ Firebase + Zustand íŒ¨í„´

### âœ… ê¶Œì¥ íŒ¨í„´
```typescript
// Store íŒŒì¼ì—ì„œ Firebase ì‹¤ì‹œê°„ ë™ê¸°í™”
const useStoreStore = create<StoreState>((set, get) => ({
  // onSnapshot í™œìš©í•œ ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”
  subscribeToStores: (ownerId: string) => {
    return onSnapshot(
      query(collection(db, 'stores'), where('ownerId', '==', ownerId)),
      (snapshot) => {
        const stores = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        set({ stores });
      }
    );
  },
}));
```

## ğŸ§¹ ì½”ë“œ í’ˆì§ˆ ê·œì¹™

### TypeScript
- **strict ëª¨ë“œ** ì¤€ìˆ˜
- ëª¨ë“  íƒ€ì… ëª…ì‹œì ìœ¼ë¡œ ì •ì˜
- `any` íƒ€ì… ì‚¬ìš© ì§€ì–‘
- ë¯¸ì‚¬ìš© import ì •ë¦¬
- **ë¯¸ì‚¬ìš© ë§¤ê°œë³€ìˆ˜** `_event` í˜•íƒœë¡œ ì²˜ë¦¬

### UI/UX ìµœì í™”
- **ë¶ˆí•„ìš”í•œ ì•„ì´ì½˜ ì œê±°** - ì´ëª¨ì§€ê°€ ì´ë¯¸ ìˆëŠ” ê²½ìš° ì¶”ê°€ ì•„ì´ì½˜ ì§€ì–‘
- **ì¹´í…Œê³ ë¦¬ íƒ­** - "ì „ì²´" ì˜µì…˜ ëŒ€ì‹  ì²« ë²ˆì§¸ ì¹´í…Œê³ ë¦¬ ìë™ ì„ íƒ
- **ë°˜ì‘í˜• ë””ìì¸** - Box + CSS Grid ì‚¬ìš©ìœ¼ë¡œ ë” ë‚˜ì€ ì„±ëŠ¥
- **ì¼ê´€ëœ ë„¤ë¹„ê²Œì´ì…˜** - ë’¤ë¡œê°€ê¸° ë²„íŠ¼ìœ¼ë¡œ ì§ê´€ì ì¸ UX
- **ë‹¤ì¤‘ ì¸í„°ë™ì…˜** - íƒ­ í´ë¦­ + ìŠ¬ë¼ì´ë“œ ë™ì‹œ ì§€ì›ìœ¼ë¡œ ì‚¬ìš©ì„± í–¥ìƒ
- **ìŠ¬ë¼ì´ë“œ ìµœì í™”** - react-swipeable ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©, WebView í„°ì¹˜ ì´ë²¤íŠ¸ ìµœì í™”

### ESLint
- **ì—ëŸ¬ 0ê°œ** ìœ ì§€
- Warningë„ ìµœëŒ€í•œ í•´ê²°
- ë¯¸ì‚¬ìš© ë³€ìˆ˜/í•¨ìˆ˜ ì •ë¦¬

### í´ë” êµ¬ì¡° ì¤€ìˆ˜
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ common/     # ê³µí†µ ì»´í¬ë„ŒíŠ¸
â”‚   â””â”€â”€ screens/    # í™”ë©´ë³„ ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ stores/         # Zustand ìƒíƒœ ê´€ë¦¬
â”œâ”€â”€ types/          # TypeScript íƒ€ì… ì •ì˜
â”œâ”€â”€ utils/          # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (WebView í—¬í¼ í¬í•¨)
â””â”€â”€ config/         # Firebase ë“± ì„¤ì •
```

## ğŸš€ ê°œë°œ ì›Œí¬í”Œë¡œìš°

### ìƒˆ ì»´í¬ë„ŒíŠ¸ ê°œë°œ ì‹œ
1. **íƒ€ì… ì •ì˜** ë¨¼ì € ì‘ì„± (`types/` í´ë”)
2. **MUI v7 ë¬¸ë²•** í™•ì¸ í›„ êµ¬í˜„
3. **WebView ìµœì í™”** ì ìš©
4. **ì‹¤ì‹œê°„ ë™ê¸°í™”** í•„ìš” ì‹œ Zustand + onSnapshot íŒ¨í„´ ì‚¬ìš©
5. **TypeScript ì—ëŸ¬** ì™„ì „ í•´ê²° í›„ ì»¤ë°‹

### í™”ë©´ ì „í™˜ êµ¬í˜„ ì‹œ
```typescript
import { optimizeWebViewTransition } from '@/utils/webviewHelper';

const handleNavigate = useCallback(() => {
  optimizeWebViewTransition(); // ê¶Œì¥!
  navigate('/target-path');
}, [navigate]);
```

### ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œ
```typescript
// requestAnimationFrame í™œìš©
const updateState = useCallback((newData: any) => {
  requestAnimationFrame(() => {
    setData(newData);
  });
}, []);
```

## ğŸ“š ì°¸ê³  íŒŒì¼
- **í”„ë¡œì íŠ¸ ì „ì²´ ì´í•´**: `PROJECT_PLAN.md` í•„ìˆ˜ ì°¸ê³ 
- **WebView í—¬í¼**: `src/utils/webviewHelper.ts`
- **íƒ€ì… ì •ì˜**: `src/types/` í´ë”
- **ìƒíƒœ ê´€ë¦¬**: `src/stores/` í´ë”

## ğŸ› ë””ë²„ê¹… ë„êµ¬
ê°œë°œ í™˜ê²½ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ì „ì—­ í•¨ìˆ˜ë“¤:
```javascript
window.debugAuth.getCurrentUser()           // í˜„ì¬ ì‚¬ìš©ì ì •ë³´
window.debugAuth.changeMyRole("store_owner") // ì—­í•  ë³€ê²½
window.debugAuth.fixTestAccounts()          // í…ŒìŠ¤íŠ¸ ê³„ì • ìˆ˜ì •
window.debugAuth.simulateFlutterLocation()  // Flutter ìœ„ì¹˜ ì •ë³´ ì‹œë®¬ë ˆì´ì…˜
window.debugAuth.removeFlutterLocation()    // Flutter ìœ„ì¹˜ ì •ë³´ ì œê±°
```

## âš ï¸ ì£¼ì˜ì‚¬í•­
- **React.memo ì‚¬ìš© ê¶Œì¥í•˜ì§€ ì•ŠìŒ** (WebView ì¦‰ì‹œ ì‘ë‹µì„± ë°©í•´)
- **MUI v6 ì´í•˜ ë¬¸ë²• ì‚¬ìš© ì§€ì–‘**
- **WebView ì „í™˜ ì „ optimizeWebViewTransition() í˜¸ì¶œ ê¶Œì¥**
- **Firebase ì¿¼ë¦¬ ìµœì í™”** - orderBy ëŒ€ì‹  í´ë¼ì´ì–¸íŠ¸ ì •ë ¬ ì„ í˜¸
- **í”„ë¡œì íŠ¸ ê·œëª¨ê°€ í¬ë¯€ë¡œ** ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ ì „ ê¸°ì¡´ êµ¬ì¡° íŒŒì•… í•„ìˆ˜

## ğŸ¯ Phase 4 ê°œë°œ ì¤€ë¹„ì‚¬í•­
ë‹¤ìŒ ë‹¨ê³„ì¸ ê³ ê°ìš© ì‹œìŠ¤í…œ ê°œë°œì„ ìœ„í•´:
- ì‹¤ì‹œê°„ ê±°ë¦¬ì¸¡ì • ê¸°ë°˜ ë§¤ì¥ ì°¾ê¸° (Flutter â†” WebView ìœ„ì¹˜ ì •ë³´ ì—°ë™) âœ…
- QRì½”ë“œ ìŠ¤ìº” ê¸°ëŠ¥ (ë³´ì¡° ìˆ˜ë‹¨)
- ê³ ê°ìš© ë©”ë‰´ ë¸Œë¼ìš°ì§• (ìŠ¬ë¼ì´ë“œ ê¸°ëŠ¥ í¬í•¨) âœ…
- ì¥ë°”êµ¬ë‹ˆ ì‹œìŠ¤í…œ
- ì£¼ë¬¸ ì²˜ë¦¬ í”Œë¡œìš°

ëª¨ë“  ìƒˆ ê¸°ëŠ¥ë„ WebView ìµœì í™”ì™€ MUI v7 í˜¸í™˜ì„±ì„ ì¤€ìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤. 